#!/usr/bin/env zsh


# export DOTFILES=$HOME/.dotfiles
# export INCLUDES=$HOME/.local/share/dotfiles

# source $DOTFILES/aliases

HISTFILE=$HOME/.zsh_history
HISTSIZE=10000
SAVEHIST=10000

bindkey -v

alias sz='source ~/.zshrc'
alias ez='vim ~/.zshrc'
alias vi=vim

source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
source $HOME/.fzf.zsh

bindkey '^?' backward-delete-char
bindkey '^L' forward-word
bindkey '^H' backward-kill-word
# bindkey '^M' autosuggest-execute    #bug not only with ctrl
# bindkey '^ ' autosuggest-accept
bindkey '^@' autosuggest-execute

export KEYTIMEOUT=1

setopt prompt_subst

git_prompt() {
  BRANCH=$(git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/*\(.*\)/\1/')

  if [ ! -z $BRANCH ]; then
    echo -n "%F{white}$BRANCH"

    if [ ! -z "$(git status --short)" ]; then
      echo " %F{red}✗"
    else
      echo " %F{green}✔"
    fi
  fi
}

function zle-line-init zle-keymap-select {
    VIM_PROMPT="%F{yellow}[NORMAL] %F{reset}"
    ERROR_CODE_PROMPT="%(?..%F{red}%? ↵ %F{reset})"
    RPS1="${${KEYMAP/vicmd/$VIM_PROMPT}/(main|viins)/}$ERROR_CODE_PROMPT$(git_prompt) $EPS1"
    zle reset-prompt
}

zle -N zle-line-init
zle -N zle-keymap-select

PS1='%F{blue}%~%F{reset} %B$%b '


# source zsh for debugging with F8
function source_zshrc {
    source ~/.zshrc
}
zle -N source_zshrc
bindkey '^[[19~' source_zshrc


# https://github.com/joshtronic/dotfiles/blob/master/zshrc
# https://dougblack.io/words/zsh-vi-mode.html
# https://unix.stackexchange.com/questions/58870/ctrl-left-right-arrow-keys-issue
# https://unix.stackexchange.com/questions/285208/how-to-remove-a-zsh-keybinding-if-i-dont-know-what-it-does
# https://github.com/zsh-users/zsh-autosuggestions
